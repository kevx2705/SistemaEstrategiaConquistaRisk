
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:p="http://primefaces.org/ui">

<ui:composition template="template/template.xhtml">
	<ui:define name="content">

		<div class="risk-background">
			<div class="game-wrapper">
				<div class="game-columns">
					<div class="left-column">
						<div class="game-board">
							<img src="assets/mapRisk.jpg" alt="Mapa Risk" class="risk-map" />
							<!-- América del Sur -->
							<button class="territory-point" style="top: 275px; left: 150px;"
								onclick="showTerritory(1)"></button>
							<!-- Venezuela -->
							<button class="territory-point" style="top: 340px; left: 175px;"
								onclick="showTerritory(2)"></button>
							<!-- Perú -->
							<button class="territory-point" style="top: 400px; left: 185px;"
								onclick="showTerritory(3)"></button>
							<!-- Argentina -->
							<button class="territory-point" style="top: 300px; left: 188px;"
								onclick="showTerritory(4)"></button>
							<!-- Brasil -->

							<!-- América del Norte -->
							<button class="territory-point" style="top: 60px; left: 40px;"
								onclick="showTerritory(5)"></button>
							<!-- Alaska -->
							<button class="territory-point" style="top: 70px; left: 110px;"
								onclick="showTerritory(6)"></button>
							<!-- Alberta -->
							<button class="territory-point" style="top: 100px; left: 140px;"
								onclick="showTerritory(7)"></button>
							<!-- Ontario -->
							<button class="territory-point" style="top: 100px; left: 188px;"
								onclick="showTerritory(8)"></button>
							<!-- Quebec -->
							<button class="territory-point" style="top: 70px; left: 110px;"
								onclick="showTerritory(9)"></button>
							<!-- Territorio del Noroeste -->
							<button class="territory-point" style="top: 60px; left: 235px;"
								onclick="showTerritory(10)"></button>
							<!-- Groenlandia -->
							<button class="territory-point" style="top: 150px; left: 100px;"
								onclick="showTerritory(11)"></button>
							<!-- Oeste de EE.UU. -->
							<button class="territory-point" style="top: 170px; left: 160px;"
								onclick="showTerritory(12)"></button>
							<!-- Este de EE.UU. -->
							<button class="territory-point" style="top: 220px; left: 100px;"
								onclick="showTerritory(13)"></button>
							<!-- América Central -->

							<!-- África -->
							<button class="territory-point" style="top: 280px; left: 400px;"
								onclick="showTerritory(21)"></button>
							<!-- Egipto -->
							<button class="territory-point" style="top: 340px; left: 410px;"
								onclick="showTerritory(22)"></button>
							<!-- África Oriental -->
							<button class="territory-point" style="top: 370px; left: 370px;"
								onclick="showTerritory(23)"></button>
							<!-- Congo -->
							<button class="territory-point" style="top: 300px; left: 350px;"
								onclick="showTerritory(24)"></button>
							<!-- África del Norte -->
							<button class="territory-point" style="top: 410px; left: 380px;"
								onclick="showTerritory(25)"></button>
							<!-- Sudáfrica -->
							<button class="territory-point" style="top: 420px; left: 465px;"
								onclick="showTerritory(26)"></button>
							<!-- Madagascar -->

							<!-- Europa -->
							<button class="territory-point" style="top: 85px; left: 292px;"
								onclick="showTerritory(14)"></button>
							<!-- Islandia -->
							<button class="territory-point" style="top: 80px; left: 380px;"
								onclick="showTerritory(15)"></button>
							<!-- Escandinavia -->
							<button class="territory-point" style="top: 150px; left: 292px;"
								onclick="showTerritory(16)"></button>
							<!-- Gran Bretaña -->
							<button class="territory-point" style="top: 160px; left: 350px;"
								onclick="showTerritory(17)"></button>
							<!-- Europa del Norte -->
							<button class="territory-point" style="top: 200px; left: 350px;"
								onclick="showTerritory(18)"></button>
							<!-- Europa del Sur -->
							<button class="territory-point" style="top: 200px; left: 310px;"
								onclick="showTerritory(19)"></button>
							<!-- Europa Occidental -->
							<button class="territory-point" style="top: 120px; left: 420px;"
								onclick="showTerritory(20)"></button>
							<!-- Ucrania -->

							<!-- Asia -->
							<button class="territory-point" style="top: 185px; left: 485px;"
								onclick="showTerritory(36)"></button>
							<!-- Afganistán -->
							<button class="territory-point" style="top: 255px; left: 440px;"
								onclick="showTerritory(27)"></button>
							<!-- Oriente Medio -->
							<button class="territory-point" style="top: 260px; left: 530px;"
								onclick="showTerritory(28)"></button>
							<!-- India -->
							<button class="territory-point" style="top: 259px; left: 585px;"
								onclick="showTerritory(29)"></button>
							<!-- Siam -->
							<button class="territory-point" style="top: 200px; left: 550px;"
								onclick="showTerritory(30)"></button>
							<!-- China -->
							<button class="territory-point" style="top: 150px; left: 590px;"
								onclick="showTerritory(31)"></button>
							<!-- Mongolia -->
							<button class="territory-point" style="top: 120px; left: 575px;"
								onclick="showTerritory(32)"></button>
							<!-- Irkutsk -->
							<button class="territory-point" style="top: 60px; left: 590px;"
								onclick="showTerritory(33)"></button>
							<!-- Yakutsk -->
							<button class="territory-point" style="top: 60px; left: 650px;"
								onclick="showTerritory(34)"></button>
							<!-- Kamchatka -->
							<button class="territory-point" style="top: 155px; left: 670px;"
								onclick="showTerritory(35)"></button>
							<!-- Japón -->
							<button class="territory-point" style="top: 130px; left: 500px;"
								onclick="showTerritory(38)"></button>
							<!-- Ural -->

							<!-- Oceanía -->
							<button class="territory-point" style="top: 350px; left: 600px;"
								onclick="showTerritory(39)"></button>
							<!-- Indonesia -->
							<button class="territory-point" style="top: 330px; left: 650px;"
								onclick="showTerritory(40)"></button>
							<!-- Nueva Guinea -->
							<button class="territory-point" style="top: 410px; left: 630px;"
								onclick="showTerritory(41)"></button>
							<!-- Australia Occidental -->
							<button class="territory-point" style="top: 430px; left: 690px;"
								onclick="showTerritory(42)"></button>
							<!-- Australia Oriental -->

						</div>





						<p:dialog widgetVar="territoryDialog" modal="true"
							header="Acciones en territorio" styleClass="dialog-risk"
							responsive="true" closable="true" width="400">
							<div class="territory-info">
								<p>
									<strong>Territorio:</strong> <span id="territoryName"></span>
								</p>
								<p>
									<strong>Dueño:</strong> <span id="territoryOwner"></span>
								</p>
								<p>
									<strong>Tropas:</strong> <span id="territoryTroops"></span>
								</p>
							</div>

							<p:separator />


						</p:dialog>

						<p:dialog widgetVar="attackDialog" header="Atacar territorio"
							modal="true" closable="true" draggable="true" resizable="false"
							width="450" styleClass="dialog-risk">
							<h:form>
								<p class="modal-title">Selecciona los territorios y tropas
									para atacar</p>

								<div class="modal-content">
									<h:outputLabel value="Desde (tu territorio):"
										for="fromTerritory" />
									<h:selectOneMenu id="fromTerritory"
										value="#{gameBean.fromTerritory}">
										<f:selectItem itemLabel="Selecciona" itemValue="" />
										<f:selectItems value="#{gameBean.territoriosAliados}" var="t"
											itemLabel="#{t}" itemValue="#{t}" />
									</h:selectOneMenu>

									<h:outputLabel value="Hacia (territorio enemigo):"
										for="toTerritory" />
									<h:selectOneMenu id="toTerritory"
										value="#{gameBean.toTerritory}">
										<f:selectItem itemLabel="Selecciona" itemValue="" />
										<f:selectItems value="#{gameBean.territoriosEnemigos}" var="t"
											itemLabel="#{t}" itemValue="#{t}" />
									</h:selectOneMenu>

									<h:outputLabel value="Tropas a usar:" for="troopsToUse" />
									<p:inputText id="troopsToUse"
										value="#{gameBean.tropasParaAtacar}" type="number" min="1"
										max="3" />

									<p class="modal-note">Regla: Máximo 3 dados para atacar.
										Debes dejar al menos 1 tropa en el territorio origen.</p>

									<div class="modal-buttons">
										<p:commandButton value="Confirmar ataque"
											action="#{gameBean.confirmarAtaque}"
											update="gameForm:dicePanel gameForm:turnInfo"
											styleClass="btn-action"
											oncomplete="PF('attackDialog').hide()" />



										<p:commandButton value="Cancelar"
											onclick="PF('attackDialog').hide()" styleClass="btn-cancel" />
									</div>
								</div>
							</h:form>
						</p:dialog>

						<p:dialog widgetVar="moveDialog" header="Mover tropas"
							modal="true" closable="true" draggable="true" resizable="false"
							width="450" styleClass="dialog-risk">
							<h:form>
								<p class="modal-title">Selecciona los territorios para mover
									tropas</p>

								<div class="modal-content">
									<h:outputLabel value="Desde (tu territorio):"
										for="fromMoveTerritory" />
									<h:selectOneMenu id="fromMoveTerritory"
										value="#{gameBean.fromMoveTerritory}">
										<f:selectItem itemLabel="Selecciona" itemValue="" />
										<f:selectItems value="#{gameBean.territoriosAliados}" var="t"
											itemLabel="#{t}" itemValue="#{t}" />
									</h:selectOneMenu>

									<h:outputLabel value="Hacia (territorio aliado):"
										for="toMoveTerritory" />
									<h:selectOneMenu id="toMoveTerritory"
										value="#{gameBean.toMoveTerritory}">
										<f:selectItem itemLabel="Selecciona" itemValue="" />
										<f:selectItems value="#{gameBean.territoriosConectados}"
											var="t" itemLabel="#{t}" itemValue="#{t}" />
									</h:selectOneMenu>

									<h:outputLabel value="Tropas a mover:" for="troopsToMove" />
									<p:inputText id="troopsToMove" value="#{gameBean.tropasAMover}"
										type="number" min="1" max="10" />

									<p class="modal-note">Regla: Solo entre territorios
										conectados y debes dejar al menos 1 tropa en el origen.</p>

									<div class="modal-buttons">
										<p:commandButton value="Confirmar movimiento"
											action="#{gameBean.confirmarMovimiento}" update="@form"
											styleClass="btn-action" oncomplete="PF('moveDialog').hide()" />

										<p:commandButton value="Cancelar"
											onclick="PF('moveDialog').hide()" styleClass="btn-cancel" />
									</div>
								</div>
							</h:form>
						</p:dialog>

						<p:dialog widgetVar="reinforceDialog" header="Reforzar territorio"
							modal="true" closable="true" draggable="true" resizable="false"
							width="450" styleClass="dialog-risk">
							<h:form>
								<p class="modal-title">Agrega tropas a uno de tus
									territorios</p>

								<div class="modal-content">
									<h:outputLabel value="Territorio a reforzar:"
										for="reinforceTerritory" />
									<h:selectOneMenu id="reinforceTerritory"
										value="#{gameBean.territorioAReforzar}">
										<f:selectItem itemLabel="Selecciona" itemValue="" />
										<f:selectItems value="#{gameBean.territoriosAliados}" var="t"
											itemLabel="#{t}" itemValue="#{t}" />
									</h:selectOneMenu>

									<h:outputLabel value="Tropas a agregar:" for="troopsToAdd" />
									<p:inputText id="troopsToAdd"
										value="#{gameBean.tropasAReforzar}" type="number" min="1"
										max="5" />

									<p class="modal-note">Regla: Reforzar solo al inicio del
										turno con tropas disponibles.</p>

									<div class="modal-buttons">
										<p:commandButton value="Confirmar refuerzo"
											action="#{gameBean.confirmarRefuerzo}" update="@form"
											styleClass="btn-action"
											oncomplete="PF('reinforceDialog').hide()" />

										<p:commandButton value="Cancelar"
											onclick="PF('reinforceDialog').hide()"
											styleClass="btn-cancel" />
									</div>
								</div>
							</h:form>
						</p:dialog>

						<div>

							<h1></h1>
							<button class="btn-show-players"
								onclick="PF('playersDialog').show()">Ver jugadores en
								partida</button>

						</div>
					</div>

					<div class="right-column">
						<h:form id="gameForm">
							<p:growl id="messages" showDetail="true" />

							<p:panel id="turnInfo" header="Turno actual"
								styleClass="panel-risk">
								<p style="margin-bottom: 10px;">
									<strong>Jugador:</strong> <span>#{partidabean.jugadorActualDTO.nombre}
									</span>
								</p>
								<p style="margin-bottom: 15px;">
									<strong>Territorios:</strong> <span>#{partidabean.jugadorActualDTO.territoriosControlados}</span>
									| <strong>Tropas disponibles:</strong> <span>#{partidabean.jugadorActualDTO.tropasDisponibles}</span>
								</p>

								<hr style="border: 1px solid #ccc; margin: 10px 0;" />

								<p style="margin-bottom: 10px;">
									<strong>Cartas</strong>
								</p>

								<div class="ui-g" style="text-align: center;">
									<div class="ui-g-4">
										<p>
											<span>Infantería</span>
										</p>
										<p>
											<i style="font-size: 2em; color: #4CAF50;"></i>
										</p>
										<p>
											<span style="font-size: 1.3em;">3</span>
										</p>
									</div>

									<div class="ui-g-4">
										<p>
											<span>Caballería</span>
										</p>
										<p>
											<i style="font-size: 2em; color: #2196F3;"></i>
										</p>
										<p>
											<span style="font-size: 1.3em;">2</span>
										</p>
									</div>

									<div class="ui-g-4">
										<p>
											<span>Artillería</span>
										</p>
										<p>
											<i style="font-size: 2em; color: #F44336;"></i>
										</p>
										<p>
											<span style="font-size: 1.3em;">1</span>
										</p>
									</div>
								</div>


								<div style="text-align: center; margin-top: 15px;">
									<p:commandButton value="Canjear cartas"
										styleClass="ui-button-success" action="#{bean.canjearCartas}"
										update="@form" />
								</div>

							</p:panel>

							<h1></h1>

							<p:panel id="faseTerritoriosPanel" header="Refuerzos"
								widgetVar="faseTerritorios" style="display: block;"
								styleClass="panel-risk">

								<!-- Spinner para seleccionar cuántas tropas reforzar -->
								<p:spinner id="spinnerTropas" value="3" min="1" max="10"
									style="margin: 10px 0;" />

								<p:messages id="mensajes" autoUpdate="true" />

								<p:selectOneMenu id="territoriosJugadorRefuerzos"
									value="#{partidabean.territorioSeleccionadoId}">
									<f:selectItem itemLabel="Selecciona un territorio" itemValue="" />
									<f:selectItems
										value="#{partidabean.territoriosDisponiblesList}" var="t"
										itemLabel="#{t.nombre}" itemValue="#{t.id}" />
								</p:selectOneMenu>

								<br />
								<br />

								<p:commandButton value="Reclamar"
									action="#{partidabean.reclamarTerritorio(partidabean.territorioSeleccionadoId)}"
									update="gameForm" process="@form" />


							</p:panel>



							<p:panel id="faseAtaquePanel" header="Ataque"
								widgetVar="faseAtaque" style="display: none;"
								styleClass="panel-risk">
								<p>Desde:</p>
								<p:selectOneMenu id="territorioOrigenAtaque"
									onchange="updateTerritoriosVecinos()">
									<f:selectItem itemLabel="Venezuela" itemValue="Venezuela" />
									<f:selectItem itemLabel="Perú" itemValue="Perú" />
								</p:selectOneMenu>
								<p>Hasta:</p>
								<p:selectOneMenu id="territorioDestinoAtaque">
									<f:selectItem itemLabel="Argentina" itemValue="Argentina" />
									<f:selectItem itemLabel="Brasil" itemValue="Brasil" />
								</p:selectOneMenu>


								<p:commandButton value="Atacar"
									onclick="PF('diceDialog').show();" style="margin-top: 10px;" />
								<br></br>
								<br></br>
								<p:commandButton value="Continuar a fase 2 >"
									onclick="cambiarFase('movimiento'); return false;" />
							</p:panel>

							<p:panel id="faseMovimientoPanel" header="Movimiento"
								widgetVar="faseMovimiento" style="display: none;"
								styleClass="panel-risk">
								<p:selectOneMenu id="territorioOrigenMovimiento"
									onchange="updateTerritoriosVecinos()">
									<f:selectItem itemLabel="Selecciona un territorio" itemValue="" />
									<f:selectItem itemLabel="Venezuela" itemValue="Venezuela" />
									<f:selectItem itemLabel="Perú" itemValue="Perú" />
								</p:selectOneMenu>
								<p:selectOneMenu id="territorioDestinoMovimiento">
									<f:selectItem itemLabel="Selecciona un territorio" itemValue="" />
									<f:selectItem itemLabel="Argentina" itemValue="Argentina" />
									<f:selectItem itemLabel="Brasil" itemValue="Brasil" />
								</p:selectOneMenu>
								<p:spinner id="tropasMovimiento" value="1" min="1" max="10"
									style="margin: 10px 0;" />
								<p:commandButton value="Mover tropas" style="margin-top: 10px;" />
								<br></br>
								<br></br>
								<p:commandButton value="Terminar turno"
									onclick="cambiarFase('territorios'); return false;" />
							</p:panel>

							<p:dialog id="dicePanel" header="Dados de ataque y defensa"
								widgetVar="diceDialog" modal="true" closable="true"
								style="display: none;" styleClass="dialog-risk">
								<div class="dice-container">
									<div class="dice-group">
										<p>Atacante (máx 3)</p>
										<div class="dice attacker-dice">
											<span class="die">1</span> <span class="die">2</span> <span
												class="die">3</span>
										</div>
									</div>
									<div class="dice-group">
										<p>Defensor (máx 2)</p>
										<div class="dice defender-dice">
											<span class="die">1</span> <span class="die">2</span>
										</div>
									</div>
								</div>
								<p:commandButton value="Lanzar Dados" styleClass="btn-roll" />
							</p:dialog>



							<p:dialog widgetVar="playersDialog" modal="true"
								header="Jugadores en partida" responsive="true" closable="true"
								width="500" styleClass="dialog-risk">
								<div class="player-cards-row">
									<!-- JUGADOR 1 -->
									<div class="player-card">
										<div class="player-info">
											<p class="player-name">#{partidabean.jugador1.nombre}</p>
											<p class="player-territories">Color:
												#{partidabean.jugador1.color}</p>
											<p class="player-troops">Tropas:
												#{partidabean.jugador1.tropasDisponibles}</p>
											<p class="player-territories">Territorios:
												#{partidabean.jugador1.territoriosControlados}</p>
										</div>
									</div>

									<!-- JUGADOR 2 -->
									<div class="player-card">
										<div class="player-info">
											<p class="player-name">#{partidabean.jugador2.nombre}</p>
											<p class="player-territories">Color:
												#{partidabean.jugador2.color}</p>
											<p class="player-troops">Tropas:
												#{partidabean.jugador2.tropasDisponibles}</p>
											<p class="player-territories">Territorios:
												#{partidabean.jugador2.territoriosControlados}</p>
										</div>
									</div>

									<!-- JUGADOR 3 -->
									<div class="player-card">
										<div class="player-info">
											<p class="player-name">#{partidabean.jugador3.nombre}</p>
											<p class="player-territories">Color:
												#{partidabean.jugador3.color}</p>
											<p class="player-troops">Tropas:
												#{partidabean.jugador3.tropasDisponibles}</p>
											<p class="player-territories">Territorios:
												#{partidabean.jugador3.territoriosControlados}</p>
										</div>
									</div>

									<!-- JUGADOR 4 -->
									<div class="player-card">
										<div class="player-info">
											<p class="player-name">#{partidabean.jugador4.nombre}</p>
											<p class="player-territories">Color:
												#{partidabean.jugador4.color}</p>
											<p class="player-troops">Tropas:
												#{partidabean.jugador4.tropasDisponibles}</p>
											<p class="player-territories">Territorios:
												#{partidabean.jugador4.territoriosControlados}</p>
										</div>
									</div>

									<!-- JUGADOR 5 -->
									<div class="player-card">
										<div class="player-info">
											<p class="player-name">#{partidabean.jugador5.nombre}</p>
											<p class="player-territories">Color:
												#{partidabean.jugador5.color}</p>
											<p class="player-troops">Tropas:
												#{partidabean.jugador5.tropasDisponibles}</p>
											<p class="player-territories">Territorios:
												#{partidabean.jugador5.territoriosControlados}</p>
										</div>
									</div>

									<!-- JUGADOR 6 -->
									<div class="player-card">
										<div class="player-info">
											<p class="player-name">#{partidabean.jugador6.nombre}</p>
											<p class="player-territories">Color:
												#{partidabean.jugador6.color}</p>
											<p class="player-troops">Tropas:
												#{partidabean.jugador6.tropasDisponibles}</p>
											<p class="player-territories">Territorios:
												#{partidabean.jugador6.territoriosControlados}</p>
										</div>
									</div>


								</div>
							</p:dialog>



						</h:form>
					</div>
				</div>
			</div>
		</div>

		<script>
		function showTerritory(idTerritorio) {
		    fetch(`http://localhost:8081/api/territorios/${id}/obtenerterritorioporid`)
	            .then(response => {
	                if (!response.ok) {
	                    throw new Error('Error al obtener el territorio');
	                }
	                return response.json();
	            })
	            .then(data => {
	                // Actualiza el diálogo con los datos del backend
	                document.getElementById('territoryName').textContent = data.nombre;
	                document.getElementById('territoryOwner').textContent = data.propietario;
	                document.getElementById('territoryTroops').textContent = data.tropas;

	                // Muestra el diálogo
	                PF('territoryDialog').show();
	            })
	            .catch(error => {
	                console.error('Error:', error);
	                alert('No se pudo cargar la información del territorio');
	            });
			function cambiarFase(fase) {
				document.getElementById('gameForm:faseTerritoriosPanel').style.display = 'none';
				document.getElementById('gameForm:faseAtaquePanel').style.display = 'none';
				document.getElementById('gameForm:faseMovimientoPanel').style.display = 'none';

				if (fase === 'territorios') {
					document.getElementById('gameForm:faseTerritoriosPanel').style.display = 'block';
				} else if (fase === 'ataque') {
					document.getElementById('gameForm:faseAtaquePanel').style.display = 'block';
				} else if (fase === 'movimiento') {
					document.getElementById('gameForm:faseMovimientoPanel').style.display = 'block';
				}
			}
		</script>
	</ui:define>
</ui:composition>
</html>